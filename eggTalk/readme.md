
# 프로젝트 소개 (Project Introduction)


<img src="https://github.com/user-attachments/assets/8d75f532-e144-4799-8c02-c08e14cac790" alt="Project Image" width="650px" height="800px">

## 프로젝트의 개요
- 개발 기간 : 2024.06 ~ 2024.07 (5주) [소스코드 link](https://github.com/Amborsia/egg-signal-server)
- 팀장으로 프로젝트 진행, 백엔드 4명, 프론트엔드 2명
## 프로젝트의 간단한 소개
- 아바타와 아이스 브레이킹과 함께하는 3:3 소개팅 서비스는 실시간 화상 채팅과 다양한 인터렉티브 기능을 제공하여 사용자들이 재미있고 자연스럽게 소통할 수 있는 온라인 소개팅 플랫폼입니다.

## 본인의 역할과 기여

### 친구와의 매칭 방지
사용자들이 친구와 매칭되는 불편함을 겪어 실제 소개팅 경험이 저하되는 문제가 있었습니다. 이를 해결하기 위해 친구 매칭 방지 알고리즘을 개발하였습니다. 친구 목록을 확인하여 친구인 참가자들이 매칭되지 않도록 큐 매칭 시스템을 개선한 결과, 친구 간의 매칭이 방지되어 사용자들이 진정한 소개팅 경험을 누릴 수 있게 되었고, 사용자 만족도가 크게 향상되었습니다.

### 실시간 화상 채팅 성능 개선
다수의 사용자가 동시에 접속할 경우 화상 채팅의 성능 저하 문제가 발생했습니다. 이를 해결하기 위해 OpenVidu를 활용하여 세션 및 토큰 관리 시스템을 효율적으로 구축하고, Redis를 사용해 실시간 데이터 캐싱 및 빠른 조회 기능을 도입했습니다. 이러한 개선을 통해 실시간 스트리밍 성능이 크게 향상되었고, 대기 시간이 감소하여 사용자 경험이 개선되었습니다.

### 코드 유지 보수성 향상
기존 monolithic 아키텍처로 인해 코드 가독성과 유지 보수성이 저하되는 문제가 있었습니다. 서비스를 여러 개의 독립적인 서비스로 분리하고, 중복 코드를 제거하며, DI(Dependency Injection)를 통한 리팩토링을 진행했습니다. 그 결과, 코드의 가독성과 유지 보수성이 크게 향상되어 개발 생산성이 높아졌습니다.

<table>
  <tr>
    <td><img src="https://github.com/user-attachments/assets/003bb190-d872-4339-be70-fb3dd4bacc74" alt="Before Image" width="300px"></td>
    <td><img src="https://github.com/user-attachments/assets/71c91462-3beb-4175-83d4-29801804f281" alt="After Image" width="300px"></td>
  </tr>
  <tr>
    <td>Before</td>
    <td>After</td>
  </tr>
</table>

### 사용자 인터랙션 기능 추가
사용자가 적극적으로 참여할 수 있는 인터랙션 기능이 부족하여 사용자 만족도가 저하되는 문제가 있었습니다. 이를 해결하기 위해 키워드 게임, 큐피드 타임 등 다양한 인터랙티브 기능을 추가하고, Socket.IO를 사용해 실시간 상호작용을 관리했습니다. 이러한 추가 기능을 통해 사용자의 참여도와 만족도가 크게 향상되었습니다.

### 팀원 간 소통 개선
프로젝트 진행 상황을 실시간으로 파악하기 어려워 팀원 간의 소통 부족 문제가 발생했습니다. 팀장으로서 매일 아침 회의를 주최하고, Github Project와 Discord를 활용해 프로젝트 관리 및 팀 내 소통을 원활하게 진행했습니다. 그 결과, 팀원 간의 소통이 원활해지고, 프로젝트 진행 상황을 실시간으로 파악하여 효율적으로 업무를 진행할 수 있게 되었습니다.

<img src="https://github.com/user-attachments/assets/6556d51a-0224-45ab-b668-cb349b8a6266" alt="Project Image" width="500px" height="300px">

## 개발 중 직면했던 도전 과제와 그에 대한 해결책
처음에는 1:1 소개팅으로 기획되어 남녀 두 명이 입장하기를 누르면 대기 큐에서 남녀 한 명씩 선택해서 매칭하는 구조였습니다. 그러나 기획이 변경되어 남녀 대기열을 분리하고 6명을 매칭해야 하는 상황이 되었습니다. 이 과정에서 남자와 여자 대기열을 분리한 뒤 남자 3명, 여자 3명이 되면 대기열을 비우고 소개팅을 진행하게 했습니다.

여기서 문제가 발생했습니다. 남녀 대기열에서 동시에 많은 인원이 접속하면, 6명, 6명이 한꺼번에 같은 방으로 입장하는 상황이 발생한 것입니다. 이는 Nest.js의 비동기 처리 방식에서 비롯된 문제였습니다. 비동기 방식에서는 여러 작업이 동시에 진행되기 때문에, 여러 사용자가 동시에 입장하면 서버가 여러 요청을 동시에 처리하게 됩니다. 이로 인해, 대기열의 상태가 동시에 업데이트되어 6명 이상이 같은 방으로 입장하게 되는 경합 상태가 발생한 것입니다.

이 문제를 해결하기 위해 저는 먼저 대기열 구조를 변경하기로 했습니다. 기존의 남녀 대기열 외에 '시작 대기열'을 추가하여, 남녀 각각의 대기열에서 일정 인원이 모이면 시작 대기열로 옮기는 방식을 도입했습니다. 이로 인해 남자 3명, 여자 3명이 모였을 때만 시작 대기열에서 매칭이 이루어지도록 했습니다.

다음으로, 비동기 처리 방식을 동기 처리 방식으로 변경하여 경합 상태를 방지했습니다. 구체적으로는, 각 사용자의 입장 요청을 처리할 때, 대기열을 업데이트하는 부분에서 await 키워드를 사용하여 하나의 요청이 완전히 처리된 후에 다음 요청을 처리하도록 했습니다. 이렇게 하면, 대기열의 상태를 변경하는 작업이 순차적으로 이루어져, 동시에 여러 요청이 처리되면서 발생하는 경합 상태를 방지할 수 있었습니다.

이 경험을 통해 비동기 처리와 동기 처리의 차이점을 깊이 이해할 수 있었고, 시스템 설계 시 정합성을 유지하는 방법에 대해 많은 것을 배울 수 있었습니다. 특히 비동기 처리가 유용할 때와 동기 처리가 더 적합할 때를 구분하는 능력을 키울 수 있었습니다. 이를 통해 앞으로의 프로젝트에서도 상황에 맞는 적절한 접근 방식을 선택할 수 있는 안목을 기를 수 있었습니다.


## 사용된 기술 및 도구
### NestJS
- NestJS를 사용함으로써 우리는 빠르게 프로토타입을 개발하고, 실시간 데이터 처리와 같은 핵심 기능을 효율적으로 구현할 수 있었습니다. 또한, 모듈화된 구조 덕분에 팀원 간의 협업이 원활해지고, 코드의 유지 보수성과 확장성이 크게 향상되었습니다.
### MongoDB
- JSON과 유사한 문서 형식을 사용하여 데이터 저장이 직관적입니다. 이 프로젝트는 스키마의 변경도가 많아 이를 쉽게 대응하기 위해 MongoDB를 선택하였습니다.
### Redis
- 인메모리 데이터 저장소로, 빠른 읽기/쓰기 성능을 제공합니다. 사용자 매칭 큐와 같은 빈번히 업데이트되는 데이터를 Redis에 캐싱하여 데이터베이스 부하를 줄이고 응답 속도를 향상시켰습니다.
### Socket.IO 
- 실시간 양방향 통신을 지원하여 사용자 간의 실시간 상호작용을 구현할 수 있습니다. 화상 채팅 및 실시간 게임 기능을 위해 Socket.IO를 사용하여 실시간 이벤트를 처리했습니다.
### OpenVidu
- 다자간 비디오 통신을 쉽게 구현할 수 있는 라이브러리입니다. 기존의 WebRTC P2P 방식 대신 SFU 방식을 채택하여, 모든 사용자가 각각의 비디오 스트림을 주고받지 않고 중앙 서버를 통해 중계하도록 하였습니다. 이를 통해 네트워크 대역폭을 절약하고, 사용자 간의 비디오 스트림을 효율적으로 관리할 수 있었습니다.

## 회고

짧은 개발 시간안에 완성도 있는 서비스를 개발해야 했는데, 이 때 다양한 기술 스택을 경험하고 여러 문제점들을 직접 몸으로 느끼면서 해결해 나갈 수 있었던 소중한 경험이었습니다. 팀장으로서 팀원들과 함께 협력하여 목표를 달성하는 과정에서 팀워크의 중요성을 깨닫게 되었고, 앞으로도 다양한 프로젝트에 참여하여 개발자로서 꾸준히 성장해나가고 싶습니다.


# 영상
[youtube](https://youtu.be/POA9S4Uwzw8)



